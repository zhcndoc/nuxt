---
title: 'å…¨é¢é™æ€åŒ–'
description: 'JAMstack çˆ±å¥½è€…æœŸå¾…å·²ä¹…çš„åŠŸèƒ½åœ¨ v2.13 ç‰ˆæœ¬ä¸­å‘å¸ƒäº†ï¼šå…¨é¢é™æ€å¯¼å‡ºã€æ™ºèƒ½é¢„å–æ”¹è¿›ã€é›†æˆçˆ¬è™«ã€æ›´å¿«çš„é‡æ–°éƒ¨ç½²ã€å†…ç½® Web æœåŠ¡å™¨å’Œæ–°çš„é…ç½®ç›®æ ‡é€‰é¡¹ âš¡ï¸'
image: /assets/blog/going-full-static.png
date: 2020-06-18
authors:
  - name: Sebastien Chopin
    avatar:
      src: https://avatar.ikxin.com/github/atinux
    to: https://x.com/atinux
    twitter: atinux
category: Release
---

## å¤ªé•¿äº†ä¸æƒ³è¯»

1. å‡çº§ Nuxt è‡³ `2.14.0`
2. åœ¨ `nuxt.config.js` ä¸­è®¾ç½® `target: 'static'`
3. æ‰§è¡Œ `nuxt generate`
4. å®Œæˆ âœ¨

_é¢å¤–å¥–åŠ±ï¼šä½ å¯ä»¥é€šè¿‡è¿è¡Œ `nuxt start` æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œä¸ºä½ ç”Ÿæˆçš„é™æ€åº”ç”¨æä¾›æœåŠ¡ã€‚_

::video{poster="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.jpg" controls autoplay}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.webm" type="video/webm"}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.mp4" type="video/mp4"}
  :source{src="https://res.cloudinary.com/nuxt/video/upload/v1588095794/nuxt-full-static_rnnbvm.ogg" type="video/ogg"}
::

æ³¨æ„ï¼šåœ¨è¿™ä¸ªè§†é¢‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å·²ç»åºŸå¼ƒçš„ `nuxt export`ï¼Œæ¨èä½¿ç”¨ `nuxt generate`ã€‚

## å†å²

Nuxt ä» [v0.3.2](https://github.com/nuxt/nuxt.js/releases/tag/v0.3.2)ï¼ˆ2016 å¹´ 11 æœˆï¼‰èµ·å°±å…·å¤‡äº†é™æ€ç”Ÿæˆçš„åŠŸèƒ½ï¼Œä¹‹åæˆ‘ä»¬åœ¨å¤šä¸ªæ–¹é¢è¿›è¡Œäº†æ”¹è¿›ï¼Œä½†å§‹ç»ˆæ²¡æœ‰å®ç°å®Œå…¨çš„é™æ€ç”Ÿæˆã€‚ä»Šå¤©ï¼Œæˆ‘å¾ˆé«˜å…´åœ°å®£å¸ƒï¼Œä½¿ç”¨ Nuxt 2.13ï¼Œç°åœ¨å¯ä»¥å®ç°å®Œå…¨çš„é™æ€å¯¼å‡ºã€‚

## å½“å‰é—®é¢˜

`nuxt generate` ä¸»è¦æ˜¯é¢„æ¸²æŸ“ï¼Œå½“ä½ åœ¨å®¢æˆ·ç«¯è¿›è¡Œå¯¼èˆªæ—¶ï¼Œä¼šè°ƒç”¨ `asyncData` å’Œ `fetch`ï¼Œ_å‘ä½ çš„ API å‘é€è¯·æ±‚_ã€‚å¾ˆå¤šç”¨æˆ·è¦æ±‚æ”¯æŒâ€œå®Œå…¨é™æ€â€æ¨¡å¼ï¼Œæ„å‘³ç€åœ¨å¯¼èˆªæ—¶ä¸è°ƒç”¨è¿™ä¸¤ä¸ªé’©å­ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªé¡µé¢å·²ç»é¢„æ¸²æŸ“å®Œæ¯•ã€‚

æ­¤å¤–ï¼Œå¼€å‘è€…ä½“éªŒä¹Ÿä¸ç†æƒ³ï¼š

- åœ¨ SSR ä¸­å¯ä»¥è®¿é—® `req` æˆ– `res`ï¼Œä½†åœ¨è¿è¡Œ `nuxt generate` æ—¶ä¸èƒ½è®¿é—®
- `process.static` ä»…åœ¨è¿è¡Œ `nuxt generate` æ—¶ä¸º `true`ï¼Œä½¿å¾—å¼€å‘ Nuxt æ¨¡å—æˆ–æ’ä»¶è¿›è¡Œé™æ€ç”Ÿæˆå˜å¾—ç¼“æ…¢
- åœ¨ `generate.routes` ä¸­å¿…é¡»æŒ‡å®šæ‰€æœ‰çš„[åŠ¨æ€è·¯ç”±](https://v2.nuxt.com/docs/features/file-system-routing#dynamic-routes)ï¼Œè¿™æ ·åšå˜å¾—æ›´å›°éš¾ï¼Œå› ä¸ºåœ¨è¯¥å¤„æ— æ³•è®¿é—®åˆ° Nuxt æ¨¡å—ã€‚
- åœ¨å¼€å‘ä¸­æ— æ³•æµ‹è¯• [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ï¼Œå›é€€æ˜¯ä½ çš„ Nuxt åº”ç”¨çš„ä»…å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œå½“è®¿é—® 404 é¡µé¢æ—¶åŠ è½½
- `nuxt generate` é»˜è®¤è¿è¡Œ `nuxt build`ï¼Œå¦‚æœåªæœ‰å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œç”Ÿæˆç½‘ç«™ä¼šå˜å¾—æ›´æ…¢

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ [nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor) æ¨¡å—å¯ä»¥å®ç°å®Œå…¨çš„é™æ€æ”¯æŒï¼Œä½†ä½¿ç”¨èµ·æ¥æ¯”è¾ƒå†—é•¿ï¼Œå¹¶ä¸”æœ‰ä¸€äº›é™åˆ¶ã€‚

## æ–°çš„é…ç½®é€‰é¡¹ï¼š`target`

ä¸ºäº†æ”¹å–„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶é€šçŸ¥ Nuxt ä½ å¸Œæœ›å°†åº”ç”¨å¯¼å‡ºåˆ°é™æ€æ‰˜ç®¡ï¼Œæˆ‘ä»¬åœ¨ä½ çš„ `nuxt.config.js` ä¸­å¼•å…¥äº†ä¸€ä¸ª `target` é€‰é¡¹ï¼š

```vue
<script setup>
  import { ref, computed } from '#imports'

  const count = ref(1)
  const double = computed(() => count.value * 2)
</script>
```

::important
å…¨é¢é™æ€åŒ–ä¸é€‚ç”¨äº `ssr: 'false'`ï¼ˆä¸å·²å¼ƒç”¨çš„ `mode: 'spa'` ç›¸åŒï¼‰ï¼Œå› ä¸ºå®ƒåªç”¨äºå®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆå•é¡µåº”ç”¨ï¼‰ã€‚
::

å½“ä½¿ç”¨é™æ€ç›®æ ‡è¿è¡Œ `nuxt dev` æ—¶ï¼Œå°†æ”¹å–„å¼€å‘è€…ä½“éªŒï¼š

- ä»ä¸Šä¸‹æ–‡ä¸­åˆ é™¤ `req` å’Œ `res`
- åœ¨ 404ã€é”™è¯¯å’Œé‡å®šå‘æ—¶å›é€€åˆ°å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆå‚è§ [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ï¼‰
- `$route.query` åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸Šå§‹ç»ˆç­‰äº `{}`
- `process.static` ä¸º `true`

æˆ‘ä»¬è¿˜å…¬å¼€äº† `process.target`ï¼Œä»¥ä¾¿æ¨¡å—ä½œè€…æ ¹æ®ç”¨æˆ·çš„ç›®æ ‡æ·»åŠ é€»è¾‘ã€‚

## æ›´æ™ºèƒ½çš„ `nuxt generate`

ç°åœ¨ï¼Œä½¿ç”¨ `v2.14.0`ï¼Œä½ å¯ä»¥ä½¿ç”¨ `nuxt generate`ï¼Œå®ƒä¼šæ™ºèƒ½åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦æ„å»ºã€‚

### éå¸¸å¿«é€Ÿçš„é™æ€åº”ç”¨ç¨‹åº

å¸¦æœ‰ `target: 'static'` çš„ `nuxt generate` å°†å°†æ‰€æœ‰é¡µé¢é¢„æ¸²æŸ“ä¸º HTMLï¼Œå¹¶ä¿å­˜ payload æ–‡ä»¶ä»¥ä¾¿åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶æ¨¡æ‹Ÿ `asyncData` å’Œ `fetch`ï¼Œè¿™æ„å‘³ç€åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶**ä¸ä¼šå†å‘èµ·å¯¹ä½ çš„ API çš„ HTTP è¯·æ±‚**ã€‚é€šè¿‡å°†é¡µé¢çš„è´Ÿè½½æå–åˆ°ä¸€ä¸ª JavaScript æ–‡ä»¶ä¸­ï¼Œ**è¿˜å¯ä»¥å‡å°æ‰€æä¾›çš„ HTML å¤§å°**ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡é¢„åŠ è½½ï¼ˆ<link> æ ‡ç­¾ä¸­çš„å†…å®¹ï¼‰å®ç°æœ€ä½³æ€§èƒ½ã€‚

å½“è¿›è¡Œå…¨é¢é™æ€åŒ–æ—¶ï¼Œæˆ‘ä»¬è¿˜æ”¹è¿›äº†[æ™ºèƒ½é¢„å–åŠŸèƒ½](/blog/introducing-smart-prefetching)ï¼Œå®ƒè¿˜å°†è·å–è½½è·ï¼Œä½¿å¾—å¯¼èˆªå³æ—¶ç”Ÿæ•ˆ ğŸ‘€

### é›†æˆçˆ¬è™«

æ­¤å¤–ï¼Œå®ƒè¿˜å†…ç½®äº†ä¸€ä¸ªçˆ¬è™«ï¼Œæ£€æµ‹æ¯ä¸ªç›¸å¯¹é“¾æ¥å¹¶ç”Ÿæˆå®ƒä»¬ï¼š

å¦‚æœä½ æƒ³è¦æ’é™¤ä¸€æ‰¹è·¯ç”±ï¼Œä½¿ç”¨ [generate.exclude](https://v2.nuxt.com/docs/configuration-glossary/configuration-generate#exclude)ã€‚ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ [generate.routes](https://v2.nuxt.com/docs/configuration-glossary/configuration-generate#routes) æ¥æ·»åŠ çˆ¬è™«æ— æ³•æ£€æµ‹åˆ°çš„é¢å¤–è·¯ç”±ã€‚

è¦ç¦ç”¨çˆ¬è™«ï¼Œåœ¨ä½ çš„ `nuxt.config.js` ä¸­è®¾ç½® `generate.crawler: false`ã€‚

### æ›´å¿«é€Ÿçš„é‡æ–°éƒ¨ç½²

é€šè¿‡å°† `nuxt build` å’Œ `nuxt export` åˆ†ç¦»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œä¸€ç³»åˆ—çš„æå‡ï¼šåªæœ‰ä½ çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶æ‰è¿›è¡Œé¢„æ¸²æŸ“ï¼Œè¿™æ„å‘³ç€ï¼šæ²¡æœ‰ webpack æ„å»º â†’ æ›´å¿«çš„é‡æ–°éƒ¨ç½²ã€‚

## æ›´æ™ºèƒ½çš„ `nuxt start`

åœ¨å°† Nuxt åº”ç”¨ç¨‹åºé™æ€ç”Ÿæˆåˆ° `dist/` åï¼Œä½¿ç”¨ `nuxt start` å¯åŠ¨ä¸€ä¸ªç”Ÿäº§çº§ HTTP æœåŠ¡å™¨ï¼Œå¹¶ä¸ºä½ çš„é™æ€åº”ç”¨æä¾›æœåŠ¡ï¼Œæ”¯æŒ [SPA å›é€€](https://v2.nuxt.com/docs/concepts/static-site-generation#spa-fallback)ã€‚

è¿™ä¸ªå‘½ä»¤éå¸¸é€‚åˆåœ¨æ¨é€åˆ°ä½ å–œçˆ±çš„é™æ€æ‰˜ç®¡æä¾›å•†ä¹‹å‰æœ¬åœ°æµ‹è¯•ä½ çš„é™æ€åº”ç”¨ç¨‹åºã€‚

## é¢„è§ˆæ¨¡å¼

æˆ‘ä»¬è‡ªå¸¦äº†å®æ—¶é¢„è§ˆæ”¯æŒï¼Œä»¥ä¾¿æŒç»­è°ƒç”¨ä½ çš„ APIï¼š

```js{}[plugins/preview.client.js]
export default async function ({ query, enablePreview }) {
  if (query.preview) {
    enablePreview()
  }
}
```

å®ƒå°†è‡ªåŠ¨åˆ·æ–°é¡µé¢æ•°æ®ï¼ˆè°ƒç”¨ `nuxtServerInit`ã€`asyncData` å’Œ `fetch`ï¼‰ã€‚

å½“æ¿€æ´»é¢„è§ˆæ¨¡å¼æ—¶ï¼Œå°†è°ƒç”¨ `asyncData` å’Œ `fetch` çš„åŸå§‹æ–¹æ³•ã€‚

## å‘½ä»¤

æ ¹æ® `target` çš„ä¸åŒï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

- `server`
  - `nuxt dev`ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨
  - `nuxt build`ï¼šå°†ä½ çš„ Nuxt åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸ºç”Ÿäº§ç‰ˆæœ¬
  - `nuxt start`ï¼šå¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `static`
  - `nuxt dev`ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå…¼å®¹é™æ€ï¼‰
  - `nuxt generate`ï¼šæ ¹æ®éœ€è¦ï¼ˆå…¼å®¹é™æ€ï¼‰å°†ä½ çš„ Nuxt åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸ºç”Ÿäº§ç‰ˆæœ¬ï¼Œå¹¶å°†ä½ çš„åº”ç”¨ç¨‹åºå¯¼å‡ºä¸ºé™æ€ HTMLï¼Œå­˜å‚¨åœ¨ `dist/` ç›®å½•ä¸­
  - `nuxt start`ï¼šä» `dist/` ç›®å½•ä¸­æä¾›ä½ çš„ç”Ÿäº§åº”ç”¨ç¨‹åº

### æ¥ä¸‹æ¥åšä»€ä¹ˆ

::read-more{to="https://v2.nuxt.com/tutorials/moving-from-nuxtjs-dotenv-to-runtime-config" target="_blank"}
äº†è§£æœ‰å…³å¦‚ä½•ä» `@nuxtjs/dotenv` è¿ç§»åˆ°è¿è¡Œæ—¶é…ç½®çš„æ›´å¤šä¿¡æ¯ã€‚
::
